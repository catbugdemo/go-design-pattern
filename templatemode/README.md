# 模板模式

## 什么是「模板模式」

抽象类定义好算法的执行步骤和具体算法，以及可能发生变化的算法定义为抽象方法。不同的子类继承该抽象类，并实现父类的抽象方法

优势：

- 不变的算法被继承复用，不变的部分高度封装，复用
- 变化的算法子类继承并具体实现：变化的部分子类只需要具体实现抽象的部分即可，方便扩展，且可不限扩展

## 什么真实业务场景可以用模板模式 ？

满足如下要求的所有场景
> 算法执行的步骤是稳定不变的，但是具体的某些算法可能存在变化的场景

| 主步骤 | 主逻辑                           | 抽奖类型                    | 子步骤         | 子逻辑                           |
|-----|-------------------------------|-------------------------|-------------|-------------------------------|
| 1   | 校验活动编号(serial_no)是否存在、并获取活动信息 | -                       | -           | -                             |
| 2   | 校验活动、场次是否正在进行                 | -                       | -           | -                             |
| 3   | 其他参数校验(**不同活动类型实现不同**)        | -                       | -           | -                             |
| 4   | 活动抽奖次数校验(同时扣减)                | -                       | -           | -                             |
| 5   | 活动是否需要消费积分                    | -                       | -           | -                             |
| 6   | 场次抽奖次数校验(同时扣减)                | -                       | -           | -                             |
| 7   | 获取场次奖品信息                      | -                       | -           | -                             |
| 8   | 获取node奖品信息(**不同活动类型实现不同**)    | **按时间抽奖类型**             | 1           | do nothing(抽取该场次的奖品即可，无需其他逻辑) |
| 8   || **按抽奖次数抽奖类型**                 | 1                       | 判断是该用户第几次抽奖 |     |
| 8   ||| 2                             | 获取对应node的奖品信息           |     |     |
| 8   ||| 3                             | 复写原所有奖品信息(抽取该node节点的奖品) |     |     |
| 8   || **按数额范围区间抽奖**                 | 1                       | 判断属于哪个数额区间  |     |
| 8   ||| 2                             | 获取对应node的奖品信息           |     |     |
| 8   ||| 3                             | 复写原所有奖品信息(抽取该node节点的奖品) |     |     |
| 9   | 抽奖                            | -                       | -           | -                             |
| 10  | 奖品数量判断                        | -                       | -           | -                             |
| 11  | 组装奖品信息                        | -                       | -           | -                             |

## 业务流程图
![](http://cdn.tigerb.cn/20200325205347.png)

## uml 图
![](http://cdn.tigerb.cn/20200326201327.jpg)